{
  "version": 3,
  "file": "body.js",
  "sourceRoot": "",
  "sources": [
    "body.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import './body.html'\r\nimport './body.css'\r\nimport './tablesort.js'\r\nimport { Betoken } from '../objects/betoken.js'\r\nimport Chart from 'chart.js'\r\nimport BigNumber from 'bignumber.js'\r\n\r\nSEND_TX_ERR = \"There was an error during sending your transaction to the Ethereum blockchain. Please check that your inputs are valid and try again later.\"\r\n\r\n#Import web3\r\nWeb3 = require 'web3'\r\nweb3 = window.web3\r\nhasWeb3 = false\r\nif typeof web3 != \"undefined\"\r\n  web3 = new Web3(web3.currentProvider)\r\n  hasWeb3 = true\r\nelse\r\n  web3 = new Web3(new Web3.providers.HttpProvider(\"https://rinkeby.infura.io/m7Pdc77PjIwgmp7t0iKI\"))\r\n\r\n#Fund object\r\nbetoken_addr = new ReactiveVar(\"0x7053e8d6d84ccab18ced63c38d7b83f25715625f\")\r\nbetoken = new Betoken(betoken_addr.get())\r\n\r\n#Session data\r\nuserAddress = new ReactiveVar(\"Not Available\")\r\nuserBalance = new ReactiveVar(BigNumber(0))\r\nkairoBalance = new ReactiveVar(BigNumber(0))\r\nkairoTotalSupply = new ReactiveVar(BigNumber(0))\r\ncyclePhase = new ReactiveVar(0)\r\nstartTimeOfCyclePhase = new ReactiveVar(0)\r\ntimeOfChangeMaking = new ReactiveVar(0)\r\ntimeOfProposalMaking = new ReactiveVar(0)\r\ntimeOfWaiting = new ReactiveVar(0)\r\ntimeOfSellOrderWaiting = new ReactiveVar(0)\r\ntotalFunds = new ReactiveVar(BigNumber(0))\r\nproposalList = new ReactiveVar([])\r\nsupportedProposalList = new ReactiveVar([])\r\nagainstProposalList = new ReactiveVar([])\r\nmemberList = new ReactiveVar([])\r\ncycleNumber = new ReactiveVar(0)\r\ncommissionRate = new ReactiveVar(BigNumber(0))\r\n\r\n#Displayed variables\r\nkairo_addr = new ReactiveVar(\"\")\r\netherDelta_addr = new ReactiveVar(\"\")\r\ndisplayedKairoBalance = new ReactiveVar(BigNumber(0))\r\ndisplayedKairoUnit = new ReactiveVar(\"KRO\")\r\ncountdownDay = new ReactiveVar(0)\r\ncountdownHour = new ReactiveVar(0)\r\ncountdownMin = new ReactiveVar(0)\r\ncountdownSec = new ReactiveVar(0)\r\nshowCountdown = new ReactiveVar(true)\r\ntransactionHash = new ReactiveVar(\"\")\r\nnetworkName = new ReactiveVar(\"\")\r\nnetworkPrefix = new ReactiveVar(\"\")\r\nchart = null\r\nprevROI = new ReactiveVar(BigNumber(0))\r\navgROI = new ReactiveVar(BigNumber(0))\r\nprevCommission = new ReactiveVar(BigNumber(0))\r\ntotalCommission = new ReactiveVar(BigNumber(0))\r\ntransactionHistory = new ReactiveVar([])\r\nerrorMessage = new ReactiveVar(\"\")\r\nsuccessMessage = new ReactiveVar(\"\")\r\n\r\nshowTransaction = (_txHash) ->\r\n  transactionHash.set(_txHash)\r\n  $(\"#transaction_sent_modal\").modal(\"show\")\r\n  return\r\n\r\nshowError = (_msg) ->\r\n  errorMessage.set(_msg)\r\n  $(\"#error_modal\").modal(\"show\")\r\n\r\nshowSuccess = (_msg) ->\r\n  successMessage.set(_msg)\r\n  $(\"#success_modal\").modal(\"show\")\r\n\r\ncopyTextToClipboard = (text) ->\r\n  textArea = document.createElement(\"textarea\")\r\n\r\n  # Place in top-left corner of screen regardless of scroll position.\r\n  textArea.style.position = 'fixed'\r\n  textArea.style.top = 0\r\n  textArea.style.left = 0\r\n\r\n  # Ensure it has a small width and height. Setting to 1px / 1em\r\n  # doesn't work as this gives a negative w/h on some browsers.\r\n  textArea.style.width = '2em'\r\n  textArea.style.height = '2em'\r\n\r\n  # We don't need padding, reducing the size if it does flash render.\r\n  textArea.style.padding = 0\r\n\r\n  # Clean up any borders.\r\n  textArea.style.border = 'none'\r\n  textArea.style.outline = 'none'\r\n  textArea.style.boxShadow = 'none'\r\n\r\n  # Avoid flash of white box if rendered for any reason.\r\n  textArea.style.background = 'transparent'\r\n\r\n  textArea.value = text\r\n\r\n  document.body.appendChild(textArea)\r\n\r\n  textArea.select()\r\n\r\n  try\r\n    successful = document.execCommand('copy')\r\n    if successful\r\n      showSuccess(\"Copied #{text} to clipboard\")\r\n    else\r\n      showError('Oops, unable to copy')\r\n  catch err\r\n    showError('Oops, unable to copy')\r\n\r\n  document.body.removeChild(textArea)\r\n  return\r\n\r\nclock = () ->\r\n  setInterval(\r\n    () ->\r\n      now = Math.floor(new Date().getTime() / 1000)\r\n      target = 0\r\n      switch cyclePhase.get()\r\n        when 0\r\n          target = startTimeOfCyclePhase.get() + timeOfChangeMaking.get()\r\n        when 1\r\n          target = startTimeOfCyclePhase.get() + timeOfProposalMaking.get()\r\n        when 2\r\n          target = startTimeOfCyclePhase.get() + timeOfWaiting.get()\r\n        when 3\r\n          target = startTimeOfCyclePhase.get() + timeOfSellOrderWaiting.get()\r\n\r\n      distance = target - now\r\n\r\n      if distance > 0\r\n        showCountdown.set(true)\r\n        days = Math.floor(distance / (60 * 60 * 24))\r\n        hours = Math.floor((distance % (60 * 60 * 24)) / (60 * 60))\r\n        minutes = Math.floor((distance % (60 * 60)) / 60)\r\n        seconds = Math.floor(distance % 60)\r\n\r\n        countdownDay.set(days)\r\n        countdownHour.set(hours)\r\n        countdownMin.set(minutes)\r\n        countdownSec.set(seconds)\r\n      else\r\n        showCountdown.set(false)\r\n  , 1000)\r\n\r\nloadFundData = () ->\r\n  proposals = []\r\n  supportedProposals = []\r\n  againstProposals = []\r\n  members = []\r\n  receivedROICount = 0\r\n\r\n  #Get Network ID\r\n  web3.eth.net.getId().then(\r\n    (_id) ->\r\n      switch _id\r\n        when 1\r\n          net = \"Main Ethereum Network\"\r\n          pre = \"\"\r\n        when 3\r\n          net = \"Ropsten Testnet\"\r\n          pre = \"ropsten.\"\r\n        when 4\r\n          net = \"Rinkeby Testnet\"\r\n          pre = \"rinkeby.\"\r\n        when 42\r\n          net = \"Kovan Testnet\"\r\n          pre = \"kovan.\"\r\n        else\r\n          net = \"Unknown Network\"\r\n          pre = \"\"\r\n      networkName.set(net)\r\n      networkPrefix.set(pre)\r\n\r\n      if _id != 4\r\n        showError(\"Please switch to Rinkeby Testnet in order to try Betoken Alpha\")\r\n      return\r\n  )\r\n\r\n  web3.eth.getAccounts().then(\r\n    (accounts) ->\r\n      web3.eth.defaultAccount = accounts[0]\r\n      return accounts[0]\r\n  ).then(\r\n    (_userAddress) ->\r\n      #Initialize user address\r\n      if typeof _userAddress != \"undefined\"\r\n        userAddress.set(_userAddress)\r\n\r\n      betoken.getMappingOrArrayItem(\"balanceOf\", _userAddress).then(\r\n        (_balance) ->\r\n          #Get user Ether deposit balance\r\n          userBalance.set(BigNumber(web3.utils.fromWei(_balance, \"ether\")))\r\n      )\r\n      betoken.getKairoBalance(_userAddress).then(\r\n        (_kairoBalance) ->\r\n          #Get user's Kairo balance\r\n          kairoBalance.set(BigNumber(_kairoBalance))\r\n          displayedKairoBalance.set(BigNumber(web3.utils.fromWei(_kairoBalance, \"ether\")).toFormat(18))\r\n      )\r\n\r\n      #Listen for transactions\r\n      transactionHistory.set([])\r\n      betoken.contracts.betokenFund.getPastEvents(\"Deposit\",\r\n        fromBlock: 0\r\n      ).then(\r\n        (_events) ->\r\n          for _event in _events\r\n            data = _event.returnValues\r\n            if data._sender == _userAddress\r\n              tmp = transactionHistory.get()\r\n              tmp.push(\r\n                type: \"Deposit\"\r\n                amount: BigNumber(data._amountInWeis).div(1e18).toFormat(4)\r\n                timestamp: new Date(+data._timestamp * 1e3).toString()\r\n              )\r\n              transactionHistory.set(tmp)\r\n      )\r\n      betoken.contracts.betokenFund.getPastEvents(\"Withdraw\",\r\n        fromBlock: 0\r\n      ).then(\r\n        (_events) ->\r\n          for _event in _events\r\n            data = _event.returnValues\r\n            if data._sender == _userAddress\r\n              tmp = transactionHistory.get()\r\n              tmp.push(\r\n                type: \"Withdraw\"\r\n                amount: BigNumber(data._amountInWeis).div(1e18).toFormat(4)\r\n                timestamp: new Date(+data._timestamp * 1e3).toString()\r\n              )\r\n              transactionHistory.set(tmp)\r\n      )\r\n  )\r\n\r\n  #Get cycle data\r\n  betoken.getPrimitiveVar(\"cyclePhase\").then(\r\n    (_cyclePhase) -> cyclePhase.set(+_cyclePhase)\r\n  )\r\n  betoken.getPrimitiveVar(\"startTimeOfCyclePhase\").then(\r\n    (_startTime) -> startTimeOfCyclePhase.set(+_startTime)\r\n  )\r\n  betoken.getPrimitiveVar(\"timeOfChangeMaking\").then(\r\n    (_time) -> timeOfChangeMaking.set(+_time)\r\n  )\r\n  betoken.getPrimitiveVar(\"timeOfProposalMaking\").then(\r\n    (_time) -> timeOfProposalMaking.set(+_time)\r\n  )\r\n  betoken.getPrimitiveVar(\"timeOfWaiting\").then(\r\n    (_time) -> timeOfWaiting.set(+_time)\r\n  )\r\n  betoken.getPrimitiveVar(\"timeOfSellOrderWaiting\").then(\r\n    (_time) -> timeOfSellOrderWaiting.set(+_time)\r\n  )\r\n  betoken.getPrimitiveVar(\"commissionRate\").then(\r\n    (_result) -> commissionRate.set(BigNumber(_result).div(1e18))\r\n  )\r\n\r\n\r\n  #Get contract addresses\r\n  kairo_addr.set(betoken.addrs.controlToken)\r\n  betoken.getPrimitiveVar(\"etherDeltaAddr\").then(\r\n    (_etherDeltaAddr) ->\r\n      etherDelta_addr.set(_etherDeltaAddr)\r\n  )\r\n\r\n  #Get statistics\r\n  prevROI.set(BigNumber(0))\r\n  avgROI.set(BigNumber(0))\r\n  prevCommission.set(BigNumber(0))\r\n  totalCommission.set(BigNumber(0))\r\n  betoken.getPrimitiveVar(\"cycleNumber\").then(\r\n    (_result) ->\r\n      cycleNumber.set(+_result)\r\n  ).then(\r\n    () ->\r\n      chart.data.datasets[0].data = []\r\n      chart.update()\r\n      betoken.contracts.betokenFund.getPastEvents(\"ROI\",\r\n        fromBlock: 0\r\n      ).then(\r\n        (_events) ->\r\n          for _event in _events\r\n            data = _event.returnValues\r\n            ROI = BigNumber(data._afterTotalFunds).minus(data._beforeTotalFunds).div(data._afterTotalFunds).mul(100)\r\n\r\n            #Update chart data\r\n            chart.data.datasets[0].data.push(\r\n              x: data._cycleNumber\r\n              y: ROI.toString()\r\n            )\r\n            chart.update()\r\n\r\n            #Update previous cycle ROI\r\n            if +data._cycleNumber == cycleNumber.get() || +data._cycleNumber == cycleNumber.get() - 1\r\n              prevROI.set(ROI)\r\n\r\n            #Update average ROI\r\n            receivedROICount += 1\r\n            avgROI.set(avgROI.get().add(ROI.minus(avgROI.get()).div(receivedROICount)))\r\n      )\r\n\r\n      betoken.contracts.betokenFund.getPastEvents(\"CommissionPaid\",\r\n        fromBlock: 0\r\n      ).then(\r\n        (_events) ->\r\n          for _event in _events\r\n            data = _event.returnValues\r\n            commission = BigNumber(data._totalCommissionInWeis)\r\n            #Update previous cycle commission\r\n            if +data._cycleNumber == cycleNumber.get() - 1\r\n              prevCommission.set(commission)\r\n\r\n            #Update total commission\r\n            totalCommission.set(totalCommission.get().add(commission))\r\n      )\r\n  )\r\n\r\n  #Get proposals & participants\r\n  Promise.all([\r\n    betoken.getKairoTotalSupply().then(\r\n      (_kairoTotalSupply) ->\r\n        #Get Kairo's total supply\r\n        kairoTotalSupply.set(BigNumber(_kairoTotalSupply))\r\n        return\r\n    ),\r\n    betoken.getPrimitiveVar(\"totalFundsInWeis\").then(\r\n      #Get total funds\r\n      (_totalFunds) -> totalFunds.set(BigNumber(_totalFunds))\r\n    )\r\n  ]).then(\r\n    () ->\r\n      Promise.all([\r\n        betoken.getArray(\"proposals\").then(\r\n          (_proposals) ->\r\n            allPromises = []\r\n            if _proposals.length > 0\r\n              getProposal = (i) ->\r\n                if _proposals[i].numFor > 0\r\n                  return betoken.getMappingOrArrayItem(\"forStakedControlOfProposal\", i).then(\r\n                    (_stake) ->\r\n                      investment = BigNumber(_stake).dividedBy(kairoTotalSupply.get()).times(web3.utils.fromWei(totalFunds.get().toString()))\r\n                      proposal =\r\n                        id: i\r\n                        token_symbol: _proposals[i].tokenSymbol\r\n                        investment: investment.toFormat(4)\r\n                        supporters: _proposals[i].numFor\r\n                      proposals.push(proposal)\r\n                  )\r\n              allPromises = (getProposal(i) for i in [0.._proposals.length - 1])\r\n            return Promise.all(allPromises)\r\n        ).then(\r\n          () ->\r\n            proposalList.set(proposals)\r\n            return\r\n        ).then(\r\n          () ->\r\n            #Filter out proposals the user supported\r\n            allPromises = []\r\n            filterProposal = (proposal) ->\r\n              betoken.getDoubleMapping(\"forStakedControlOfProposalOfUser\", proposal.id, userAddress.get()).then(\r\n                (_stake) ->\r\n                  _stake = BigNumber(web3.utils.fromWei(_stake))\r\n                  if _stake.greaterThan(0)\r\n                    proposal.user_stake = _stake\r\n                    supportedProposals.push(proposal)\r\n              )\r\n            allPromises = (filterProposal(proposal) for proposal in proposalList.get())\r\n            return Promise.all(allPromises)\r\n        ).then(\r\n          () ->\r\n            supportedProposalList.set(supportedProposals)\r\n            return\r\n        ).then(\r\n          () ->\r\n            #Filter out proposals the user is against\r\n            allPromises = []\r\n            filterProposal = (proposal) ->\r\n              betoken.getDoubleMapping(\"againstStakedControlOfProposalOfUser\", proposal.id, userAddress.get()).then(\r\n                (_stake) ->\r\n                  _stake = BigNumber(web3.utils.fromWei(_stake))\r\n                  if _stake.greaterThan(0)\r\n                    proposal.user_stake = _stake\r\n                    againstProposals.push(proposal)\r\n              )\r\n            allPromises = (filterProposal(proposal) for proposal in proposalList.get())\r\n            return Promise.all(allPromises)\r\n        ).then(\r\n          () ->\r\n            againstProposalList.set(againstProposals)\r\n            return\r\n        ),\r\n        betoken.getArray(\"participants\").then(\r\n          (_array) ->\r\n            #Get member addresses\r\n            members = new Array(_array.length)\r\n            if _array.length > 0\r\n              for i in [0.._array.length - 1]\r\n                members[i] = new Object()\r\n                members[i].address = _array[i]\r\n            return\r\n        ).then(\r\n          () ->\r\n            #Get member ETH balances\r\n            if members.length > 0\r\n              setBalance = (id) ->\r\n                betoken.getMappingOrArrayItem(\"balanceOf\", members[id].address).then(\r\n                  (_eth_balance) ->\r\n                    members[id].eth_balance = BigNumber(web3.utils.fromWei(_eth_balance, \"ether\")).toFormat(4)\r\n                    return\r\n                )\r\n              allPromises = (setBalance(i) for i in [0..members.length - 1])\r\n              return Promise.all(allPromises)\r\n        ).then(\r\n          () ->\r\n            #Get member KRO balances\r\n            if members.length > 0\r\n              setBalance = (id) ->\r\n                betoken.getKairoBalance(members[id].address).then(\r\n                  (_kro_balance) ->\r\n                    members[id].kro_balance = BigNumber(web3.utils.fromWei(_kro_balance, \"ether\")).toFormat(4)\r\n                    return\r\n                )\r\n              allPromises = (setBalance(i) for i in [0..members.length - 1])\r\n              return Promise.all(allPromises)\r\n        ).then(\r\n          () ->\r\n            #Get member KRO proportions\r\n            for member in members\r\n              member.kro_proportion = BigNumber(member.kro_balance).dividedBy(web3.utils.fromWei(kairoTotalSupply.get().toString())).times(100).toPrecision(4)\r\n            return\r\n        ).then(\r\n          () ->\r\n            #Update reactive_list\r\n            memberList.set(members)\r\n        )\r\n      ])\r\n  )\r\n\r\n  return\r\n\r\n$('document').ready(() ->\r\n  $('.menu .item').tab()\r\n  $('table').tablesort()\r\n\r\n  if typeof web3 != \"undefined\"\r\n    web3.eth.net.getId().then(\r\n      (_id) ->\r\n        if _id != 4\r\n          showError(\"Please switch to Rinkeby Testnet in order to try Betoken Alpha\")\r\n        return\r\n    )\r\n\r\n    clock()\r\n\r\n    chart = new Chart($(\"#myChart\"),\r\n      type: 'line',\r\n      data:\r\n        datasets: [\r\n          label: \"ROI Per Cycle\"\r\n          backgroundColor: 'rgba(0, 0, 100, 0.5)'\r\n          borderColor: 'rgba(0, 0, 100, 1)'\r\n          data: []\r\n        ]\r\n      ,\r\n      options:\r\n        scales:\r\n          xAxes: [\r\n            type: 'linear'\r\n            position: 'bottom'\r\n            scaleLabel:\r\n              display: true\r\n              labelString: 'Investment Cycle'\r\n            ticks:\r\n              stepSize: 1\r\n          ]\r\n          yAxes: [\r\n            type: 'linear'\r\n            position: 'left'\r\n            scaleLabel:\r\n              display: true\r\n              labelString: 'Percent'\r\n            ticks:\r\n              beginAtZero: true\r\n          ]\r\n    )\r\n\r\n    #Initialize Betoken object\r\n    betoken.init().then(loadFundData)\r\n\r\n  if !hasWeb3\r\n    showError(\"Betoken can only be used in a Web3 enabled browser. Please install Metamask or switch to another browser that supports Web3. You can currently view the fund's data, but cannot make any interactions.\")\r\n)\r\n\r\nTemplate.body.helpers(\r\n  transaction_hash: () -> transactionHash.get()\r\n  network_prefix: () -> networkPrefix.get()\r\n  error_msg: () -> errorMessage.get()\r\n  success_msg: () -> successMessage.get()\r\n)\r\n\r\nTemplate.body.events(\r\n  \"click .copyable\": (event) ->\r\n    copyTextToClipboard(event.target.innerText)\r\n)\r\n\r\nTemplate.top_bar.helpers(\r\n  show_countdown: () -> showCountdown.get()\r\n  betoken_addr: () -> betoken_addr.get()\r\n  kairo_addr: () -> kairo_addr.get()\r\n  etherdelta_addr: () -> etherDelta_addr.get()\r\n)\r\n\r\nTemplate.top_bar.events(\r\n  \"click .next_phase\": (event) ->\r\n    try\r\n      betoken.endPhase(showTransaction)\r\n    catch error\r\n      console.log error\r\n\r\n  \"click .change_contract\": (event) ->\r\n    $('#change_contract_modal').modal(\r\n      onApprove: (e) ->\r\n        try\r\n          new_addr = $(\"#contract_addr_input\")[0].value\r\n          betoken_addr.set(new_addr)\r\n          betoken = new Betoken(betoken_addr.get())\r\n          betoken.init().then(loadFundData)\r\n        catch error\r\n          # Todo catch errors\r\n          showError(\"Oops! That wasn't a valid contract address!\")\r\n    ).modal('show')\r\n\r\n  \"click .refresh_button\": (event) ->\r\n    loadFundData()\r\n)\r\n\r\nTemplate.countdown_timer.helpers(\r\n  day: () -> countdownDay.get()\r\n  hour: () -> countdownHour.get()\r\n  minute: () -> countdownMin.get()\r\n  second: () -> countdownSec.get()\r\n)\r\n\r\nTemplate.phase_indicator.helpers(\r\n  phase_active: (index) ->\r\n    if cyclePhase.get() == index\r\n      return \"active\"\r\n    return \"\"\r\n)\r\n\r\nTemplate.sidebar.helpers(\r\n  network_name: () -> networkName.get()\r\n  user_address: () -> userAddress.get()\r\n  user_balance: () -> userBalance.get().toFormat(18)\r\n  user_kairo_balance: () -> displayedKairoBalance.get()\r\n  kairo_unit: () -> displayedKairoUnit.get()\r\n  expected_commission: () ->\r\n    if kairoTotalSupply.get().greaterThan(0)\r\n      return kairoBalance.get().div(kairoTotalSupply.get()).mul(totalFunds.get().div(1e18)).mul(avgROI.get().add(100).div(100)).mul(commissionRate.get()).toFormat(18)\r\n    return BigNumber(0).toFormat(18)\r\n)\r\n\r\nTemplate.sidebar.events(\r\n  \"click .kairo_unit_switch\": (event) ->\r\n    if event.target.checked\r\n      #Display proportion\r\n      displayedKairoBalance.set(kairoBalance.get().dividedBy(kairoTotalSupply.get()).times(\"100\").toFormat(18))\r\n      displayedKairoUnit.set(\"%\")\r\n    else\r\n      #Display Kairo\r\n      displayedKairoBalance.set(BigNumber(web3.utils.fromWei(kairoBalance.get().toString(), \"ether\")).toFormat(18))\r\n      displayedKairoUnit.set(\"KRO\")\r\n)\r\n\r\nTemplate.transact_box.onCreated(\r\n  () ->\r\n    Template.instance().depositInputHasError = new ReactiveVar(false)\r\n    Template.instance().withdrawInputHasError = new ReactiveVar(false)\r\n    Template.instance().kairoAmountInputHasError = new ReactiveVar(false)\r\n    Template.instance().kairoRecipientInputHasError = new ReactiveVar(false)\r\n)\r\n\r\nTemplate.transact_box.helpers(\r\n  is_disabled: (_type) ->\r\n    if cyclePhase.get() != 0 || (cycleNumber.get() == 1 && _type == 'withdraw')\r\n      return \"disabled\"\r\n    return \"\"\r\n\r\n  has_error: (input_id) ->\r\n    hasError = false\r\n    switch input_id\r\n      when 0\r\n        hasError = Template.instance().depositInputHasError.get()\r\n      when 1\r\n        hasError = Template.instance().withdrawInputHasError.get()\r\n      when 2\r\n        hasError = Template.instance().kairoAmountInputHasError.get()\r\n      when 3\r\n        hasError = Template.instance().kairoRecipientInputHasError.get()\r\n\r\n    if hasError\r\n      return \"error\"\r\n    return \"\"\r\n\r\n  transaction_history: () -> transactionHistory.get()\r\n)\r\n\r\nTemplate.transact_box.events(\r\n  \"click .deposit_button\": (event) ->\r\n    try\r\n      Template.instance().depositInputHasError.set(false)\r\n      amount = BigNumber(web3.utils.toWei($(\"#deposit_input\")[0].value))\r\n\r\n      if !amount.greaterThan(0)\r\n        Template.instance().kairoAmountInputHasError.set(true)\r\n        return\r\n\r\n      betoken.deposit(amount, showTransaction)\r\n    catch\r\n      Template.instance().depositInputHasError.set(true)\r\n\r\n  \"click .withdraw_button\": (event) ->\r\n    try\r\n      Template.instance().withdrawInputHasError.set(false)\r\n      amount = BigNumber(web3.utils.toWei($(\"#withdraw_input\")[0].value))\r\n\r\n      if !amount.greaterThan(0)\r\n        Template.instance().kairoAmountInputHasError.set(true)\r\n        return\r\n\r\n      # Check that Betoken balance is > withdraw amount\r\n      if amount.greaterThan(userBalance.get().times(1e18))\r\n        showError(\"Oops! You tried to withdraw more Ether than you have in your account!\")\r\n        Template.instance().withdrawInputHasError.set(true)\r\n        return\r\n\r\n      betoken.withdraw(amount, showTransaction)\r\n    catch error\r\n      console.log userBalance\r\n      Template.instance().withdrawInputHasError.set(true)\r\n\r\n  \"click .kairo_send_button\": (event) ->\r\n    try\r\n      Template.instance().kairoAmountInputHasError.set(false)\r\n      Template.instance().kairoRecipientInputHasError.set(false)\r\n\r\n      amount = BigNumber(web3.utils.toWei($(\"#kairo_amount_input\")[0].value))\r\n      toAddress = $(\"#kairo_recipient_input\")[0].value\r\n\r\n      if !amount.greaterThan(0) || amount.greaterThan(kairoBalance.get())\r\n        Template.instance().kairoAmountInputHasError.set(true)\r\n        return\r\n\r\n      if !web3.utils.isAddress(toAddress)\r\n        Template.instance().kairoRecipientInputHasError.set(true)\r\n        return\r\n\r\n      betoken.sendKairo(toAddress, amount, showTransaction)\r\n    catch\r\n      Template.instance().kairoAmountInputHasError.set(true)\r\n)\r\n\r\nTemplate.staked_props_box.helpers(\r\n  supported_proposals: () -> supportedProposalList.get()\r\n  against_proposals: () -> againstProposalList.get()\r\n\r\n  is_disabled: () ->\r\n    if cyclePhase.get() != 1\r\n      return \"disabled\"\r\n    return \"\"\r\n)\r\n\r\nTemplate.staked_props_box.events(\r\n  \"click .cancel_support_button\": (event) ->\r\n    betoken.cancelSupport(this.id, showTransaction)\r\n)\r\n\r\nTemplate.stats_tab.helpers(\r\n  member_count: () -> memberList.get().length\r\n  cycle_length: () -> BigNumber(timeOfChangeMaking.get() + timeOfProposalMaking.get() + timeOfWaiting.get() + timeOfSellOrderWaiting.get()).div(24 * 60 * 60).toDigits(3)\r\n  total_funds: () -> totalFunds.get().div(\"1e18\").toFormat(2)\r\n  prev_roi: () -> prevROI.get().toFormat(2)\r\n  avg_roi: () -> avgROI.get().toFormat(2)\r\n  prev_commission: () -> prevCommission.get().div(1e18).toFormat(2)\r\n  historical_commission: () -> totalCommission.get().div(1e18).toFormat(2)\r\n)\r\n\r\nTemplate.proposals_tab.helpers(\r\n  proposal_list: () -> proposalList.get()\r\n\r\n  is_disabled: () ->\r\n    if cyclePhase.get() != 1\r\n      return \"disabled\"\r\n    return \"\"\r\n)\r\n\r\nTemplate.proposals_tab.events(\r\n  \"click .support_proposal\": (event) ->\r\n    id = this.id\r\n    $('#support_proposal_modal_' + id).modal(\r\n      onApprove: (e) ->\r\n        try\r\n          kairoAmountInWeis = BigNumber($(\"#stake_input_\" + id)[0].value).times(\"1e18\")\r\n          betoken.supportProposal(id, kairoAmountInWeis, showTransaction)\r\n        catch error\r\n          showError(\"There was an error in your input. Please fix it and try again.\")\r\n    ).modal('show')\r\n\r\n  \"click .new_proposal\": (event) ->\r\n    $('#new_proposal_modal').modal(\r\n      onApprove: (e) ->\r\n        try\r\n          address = $(\"#address_input_new\")[0].value\r\n          tickerSymbol = $(\"#ticker_input_new\")[0].value\r\n          decimals = +$(\"#decimals_input_new\")[0].value\r\n          kairoAmountInWeis = BigNumber($(\"#stake_input_new\")[0].value).times(\"1e18\")\r\n          betoken.createProposal(address, tickerSymbol, decimals, kairoAmountInWeis, showTransaction)\r\n        catch error\r\n          showError(\"There was an error in your input. Please fix it and try again.\")\r\n    ).modal('show')\r\n)\r\n\r\nTemplate.members_tab.helpers(\r\n  member_list: () -> memberList.get()\r\n)\r\n"
  ]
}